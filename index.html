<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Slope | StaticQuasar931</title>

  <!-- Make Unity template relative paths resolve to your repo -->
  <base href="https://staticquasar931.github.io/slope/">

  <style>
    html,body{margin:0;padding:0;width:100%;height:100%;background:#231f20;overflow:hidden;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .webgl-content{position:fixed;inset:0;display:flex;align-items:center;justify-content:center}
    #gameContainer{width:100vw;height:100vh;background:#231f20;position:relative}

    /* Brand top right. Will hide after load */
    .sq-brand{
      position:fixed; right:16px; top:16px; z-index:30;
      display:flex; flex-direction:column; gap:10px; align-items:flex-end;
      max-width:min(460px, 48vw);
      pointer-events:none;
    }
    .sq-card{
      pointer-events:auto;
      background:rgba(18,22,32,.9);
      border:1px solid rgba(255,255,255,.12);
      border-radius:14px;
      padding:12px 14px;
      box-shadow:0 8px 26px rgba(0,0,0,.45);
      backdrop-filter:blur(6px);
    }
    .sq-logo{display:flex;align-items:center;gap:12px}
    .sq-logo img{width:64px;height:64px;border-radius:14px;object-fit:cover;box-shadow:0 6px 18px rgba(0,0,0,.45)}
    .sq-title{font-weight:1000;letter-spacing:.2px;font-size:18px;color:#eaf6ff}
    .sq-sub{font-weight:900;font-size:14px;color:#cfe1ff;opacity:.92;margin-top:2px}

    /* Tips bottom left. Will hide after load */
    .sq-tip-wrap{position:fixed;left:14px;bottom:16px;z-index:28;max-width:min(560px,72vw)}
    .sq-tip{background:rgba(15,18,28,.9);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:10px 12px;box-shadow:0 8px 22px rgba(0,0,0,.45);font-size:13px;line-height:1.35;color:#cfe1ff}
    .sq-tip b{color:#9fe4ff}

    .fade-out{opacity:0;transition:opacity .25s ease}
    @media (max-width:860px){ .sq-brand{right:10px;top:10px;max-width:66vw} }
  </style>

  <!-- Unity template CSS and loader JS from your repo -->
  <link rel="stylesheet" href="TemplateData/style.css"/>
  <link rel="stylesheet" href="style/style.css"/>
  <script src="TemplateData/UnityProgress.js"></script>
  <script src="UnityLoader.js"></script>

  <!-- Tips from repo root -->
  <script src="tips.js" defer></script>

  <script>
    window.onbeforeunload = () => "Are you sure you want to leave? Your progress may not be saved.";

    /* Tips: rotate every 10s, then hide after load */
    (function(){
      function initTips(){
        const wrap = document.getElementById("sqTipWrap");
        const el   = document.getElementById("sqTip");
        if (!wrap || !el) return;

        const getTips = () => (Array.isArray(window.SQ_TIPS) && window.SQ_TIPS.length)
          ? window.SQ_TIPS
          : [
              "Use A and D or arrow keys for gentle corrections.",
              "Short taps beat hard turns.",
              "Center first, then correct.",
              "Chromebook trackpad works best with short swipes."
            ];

        let tips = getTips().slice();
        let i = 0;
        const show = () => {
          if (!tips.length) tips = getTips().slice();
          el.innerHTML = "<b>Tip</b> " + tips[i % tips.length];
          i++;
        };
        show();
        let timer = setInterval(show, 10000);

        window.addEventListener("SQ_TIPS_READY", () => {
          tips = getTips().slice(); i = 0; show();
          clearInterval(timer); timer = setInterval(show, 10000);
        });

        window.__sq_tips_hide_on_loaded__ = () => {
          try { show(); } catch(e){}
          wrap.classList.add("fade-out");
          setTimeout(()=>{ wrap.style.display = "none"; }, 260);
        };
      }
      if (document.readyState === "complete") initTips();
      else window.addEventListener("load", initTips);
    })();

    /* Unity default loader with numeric-only progress to UnityProgress.
       Complete only after runtime is ready. Also hides branding and tips then. */
    (function(){
      let gameInstance = null;
      let finished = false;
      let lastP = 0;

      function hideBrandingAndTips(){
        const brand = document.getElementById("sqBrand");
        if (brand){
          brand.classList.add("fade-out");
          setTimeout(()=>{ brand.style.display = "none"; }, 260);
        }
        try { window.__sq_tips_hide_on_loaded__ && window.__sq_tips_hide_on_loaded__(); } catch(e){}
      }

      function finishUnityLoader(){
        if (finished) return;
        finished = true;
        try { window.UnityProgress && window.UnityProgress(gameInstance, "complete"); } catch(e){}
        hideBrandingAndTips();
      }

      function onUnityProgress(inst, progress){
        let p = 0;

        if (typeof progress === "number") {
          p = progress;
        } else if (progress && typeof progress.progress === "number") {
          p = progress.progress;
        } else if (progress && typeof progress.loaded === "number" && typeof progress.total === "number" && progress.total > 0) {
          p = progress.loaded / progress.total;
        } else if (progress === "complete") {
          p = 1;
        }

        if (p < 0) p = 0;
        if (p > 1) p = 1;

        // Always feed numeric progress so UnityProgress math never breaks
        try { window.UnityProgress && window.UnityProgress(inst, p); } catch(e){}

        lastP = p;
        // Do not finish here. Wait for runtime init.
      }

      function start(){
        const c = document.getElementById("gameContainer");
        if (!c) return;
        c.style.width  = innerWidth + "px";
        c.style.height = innerHeight + "px";

        gameInstance = UnityLoader.instantiate(
          "gameContainer",
          "https://staticquasar931.github.io/slope/slope_new.json",
          {
            onProgress: onUnityProgress,
            Module: {
              onRuntimeInitialized: function(){
                // Push bar to 1, then complete
                try { window.UnityProgress && window.UnityProgress(gameInstance, Math.max(lastP, 1)); } catch(e){}
                finishUnityLoader();
              }
            }
          }
        );

        // Watchdog
        let tries = 0;
        const t = setInterval(()=>{
          if (!gameInstance || finished) { clearInterval(t); return; }
          const ran = gameInstance.Module && (gameInstance.Module.calledRun || gameInstance.Module.runtimeInitialized);
          if (ran) {
            try { window.UnityProgress && window.UnityProgress(gameInstance, Math.max(lastP, 1)); } catch(e){}
            clearInterval(t);
            finishUnityLoader();
          } else if (tries > 120) {
            try { window.UnityProgress && window.UnityProgress(gameInstance, Math.max(lastP, 1)); } catch(e){}
            clearInterval(t);
            finishUnityLoader();
          }
          tries++;
        }, 500);
      }

      if (document.readyState === "complete") start();
      else window.addEventListener("load", start);

      window.addEventListener("resize", () => {
        const c = document.getElementById("gameContainer");
        if (c){
          c.style.width  = innerWidth + "px";
          c.style.height = innerHeight + "px";
        }
      });
    })();
  </script>
</head>
<body>
  <!-- Unity default loader renders inside this container -->
  <div class="webgl-content"><div id="gameContainer"></div></div>

  <!-- Branding card. Auto hides after Unity finishes -->
  <div class="sq-brand" id="sqBrand">
    <div class="sq-card">
      <div class="sq-logo">
        <img src="https://res.cloudinary.com/dcsrqennd/image/upload/v1760208794/My%20Brand/Static_pfp_2_nqzjkd.jpg" alt="StaticQuasar931 logo">
        <div>
          <div class="sq-title">StaticQuasar931 Presents</div>
          <div class="sq-sub">Slope Stable Unblocked. Works on school Wi Fi.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tips bottom-left. Auto hides after Unity finishes -->
  <div class="sq-tip-wrap" id="sqTipWrap">
    <div class="sq-tip" id="sqTip"><b>Tip</b> Loading tipsâ€¦</div>
  </div>
</body>
</html>
